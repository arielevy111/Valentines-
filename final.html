<!doctype html>
<html lang="he" dir="rtl">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>×”×©××œ×” ğŸ’˜</title>
  <link rel="stylesheet" href="assets/style.css"/>
  <style>
    /* Page-specific tweaks */
    #arena{
      position:relative;
      height: 180px;
      display:flex;
      align-items:center;
      justify-content:center;
      gap: 14px;
      flex-wrap:wrap;
    }
    #no{
      position:absolute;
      left:50%;
      top:72%;
      transform: translate(-50%, -50%);
      touch-action:none;
    }
    canvas{
      position:fixed;
      inset:0;
      pointer-events:none;
    }
  </style>
</head>
<body>
  <canvas id="fx"></canvas>

  <div class="card" id="card">
    <div class="header">
      <a class="btn soft" href="index.html">â¬… ×—×–×¨×”</a>
      <div class="badge">×”×¡×•×£ ×”×’×“×•×œ ğŸ</div>
    </div>

    <h1>×¨×’×¢ ×œ×¤× ×™â€¦</h1>
    <p id="gateText">×‘×•×“×§ ×× ×¡×™×™××ª ××ª ×”××©×—×§×™× ğŸ™‚</p>

    <div class="panel" id="gatePanel">
      <div class="small" id="gateList"></div>
      <div class="nav" style="margin-top:12px;">
        <a class="btn soft" href="quiz.html">×œ×©××œ×•×Ÿ</a>
        <a class="btn soft" href="memory.html">×œ×–×™×›×¨×•×Ÿ</a>
        <a class="btn soft" href="riddles.html">×œ×—×™×“×•×ª</a>
      </div>
    </div>

    <div class="panel" id="mainPanel" style="display:none;">
      <h1 style="margin-top:0;">{{HER_NAME}}â€¦ ×¨×•×¦×” ×œ×¦××ª ××™×ª×™ ×œ×™×•× ×”××”×‘×”? ğŸ’˜</h1>
      <p>
        ×”×‘×˜×—×”: ×“×™×™×˜ ×›×™×¤×™ + ××•×›×œ ×˜×•×‘ + ×–××Ÿ ×©×œ× ×•.
        ×•×”×›×™ ×—×©×•×‘â€”×× ×™ ×‘×××ª ×‘×•×—×¨ ×‘×š.
      </p>

      <div id="arena">
        <button class="btn primary" id="yes">×›×Ÿ ğŸ˜</button>
        <button class="btn danger" id="no">×œ× ğŸ™ƒ</button>
      </div>

      <div class="hr"></div>
      <div class="panel" style="background: rgba(34,197,94,.06); border: 1px solid rgba(34,197,94,.18);">
        <b>×ª×•×›× ×™×ª ×“×™×™×˜ (×ª×©× ×” ××ª ×–×” ×œ××” ×©×‘× ×œ×š)</b>
        <div class="note" style="margin-top:6px;">
          1) ××§×•× ×¨××©×•×Ÿ: ________ <br/>
          2) ××©×”×• ×§×˜×Ÿ ×•××ª×•×§: ________ <br/>
          3) ×”×œ×™×›×” / ×™×©×™×‘×” ×©×§×˜×”: ________ <br/>
          4) ×‘×¡×•×£: â€œ×¨×§ ×× ×—× ×•â€ âœ¨
        </div>
      </div>

      <div class="toast" id="msg"></div>
      <div class="nav" style="margin-top:12px; display:none;" id="afterYes">
        <a class="btn secondary" id="wa" href="#">×œ×©×œ×•×— ×œ×™ ×”×•×“×¢×ª â€œ×›×Ÿâ€ ×‘×•×•××˜×¡××¤ ğŸ’¬</a>
      </div>
    </div>
  </div>

<script>
  // English comments
  const must = [
    {k:"val_quiz_done", name:"×©××œ×•×Ÿ ×–×•×’×™"},
    {k:"val_memory_done", name:"×–×™×›×¨×•×Ÿ"},
    {k:"val_riddles_done",name:"×—×™×“×•×ª"}
  ];
  const done = (k)=> localStorage.getItem(k)==="1";
  const okCount = ()=> must.filter(x=>done(x.k)).length;

  const gateText = document.getElementById("gateText");
  const gatePanel = document.getElementById("gatePanel");
  const mainPanel = document.getElementById("mainPanel");
  const gateList = document.getElementById("gateList");

  function renderGate(){
    const lines = must.map(x=> `${done(x.k)?"âœ…":"â¬œ"} ${x.name}`).join(" Â· ");
    gateList.textContent = lines;

    if(okCount()===3){
      gateText.textContent = "×¡×™×™××ª ×”×›×•×œ ğŸ˜ ××– ×”× ×” ×”×©××œ×”â€¦";
      gatePanel.style.display="none";
      mainPanel.style.display="block";
    }else{
      gateText.textContent = "×¢×•×“ ×§×¦×ª ğŸ™‚ ×ª×¡×™×™××™ ××ª ×”××©×—×§×™× ×•××– ×ª×—×–×¨×™ ×œ×›××Ÿ";
      gatePanel.style.display="block";
      mainPanel.style.display="none";
    }
  }

  // No button dodge
  const noBtn = document.getElementById("no");
  const arena = document.getElementById("arena");
  function moveNo(){
    const a = arena.getBoundingClientRect();
    const b = noBtn.getBoundingClientRect();
    const padding = 10;
    const maxX = a.width - b.width - padding;
    const maxY = a.height - b.height - padding;
    const x = Math.random()*maxX + padding;
    const y = Math.random()*maxY + padding;
    noBtn.style.left = x + "px";
    noBtn.style.top  = y + "px";
    noBtn.style.transform = "translate(0,0)";
  }
  noBtn.addEventListener("mouseenter", moveNo);
  noBtn.addEventListener("pointerdown", (e)=>{ e.preventDefault(); moveNo(); });
  noBtn.addEventListener("click", (e)=>{ e.preventDefault(); moveNo(); });

  // Confetti
  const cvs = document.getElementById("fx");
  const ctx = cvs.getContext("2d");
  function resize(){ cvs.width = innerWidth; cvs.height = innerHeight; }
  addEventListener("resize", resize); resize();

  let pieces = [];
  function confetti(){
    pieces = [];
    for(let i=0;i<180;i++){
      pieces.push({
        x: Math.random()*cvs.width,
        y: -20 - Math.random()*cvs.height*0.3,
        r: 3 + Math.random()*4,
        vy: 2 + Math.random()*4,
        vx: -1 + Math.random()*2,
        a: Math.random()*Math.PI*2,
        va: -0.1 + Math.random()*0.2
      });
    }
    let t=0;
    (function anim(){
      t++;
      ctx.clearRect(0,0,cvs.width,cvs.height);
      pieces.forEach(p=>{
        p.x += p.vx; p.y += p.vy; p.a += p.va;
        ctx.save();
        ctx.translate(p.x,p.y);
        ctx.rotate(p.a);
        ctx.globalAlpha = 0.9;
        ctx.fillRect(-p.r, -p.r, p.r*2, p.r*2);
        ctx.restore();
      });
      pieces = pieces.filter(p=>p.y < cvs.height+30);
      if(t < 220 && pieces.length) requestAnimationFrame(anim);
      else ctx.clearRect(0,0,cvs.width,cvs.height);
    })();
  }

  // Yes flow
  const yesBtn = document.getElementById("yes");
  const msg = document.getElementById("msg");
  const afterYes = document.getElementById("afterYes");
  const wa = document.getElementById("wa");

  yesBtn.addEventListener("click", ()=>{
    msg.textContent = "×™××××! ğŸ˜ ×™×“×¢×ª×™. ×¢×›×©×™×• ×× ×™ ×§×•×‘×¢ ×©×¢×” ×•××§×•× ×•×©×•×œ×— ×œ×š ğŸ’Œ";
    afterYes.style.display = "flex";
    confetti();

    // WhatsApp deep link (change number if you want to send to yourself)
    // Using blank number opens chooser on many devices.
    const text = encodeURIComponent("×›×Ÿ ğŸ˜ ×× ×™ ××™×ª×š ×‘×™×•× ×”××”×‘×”. ×§×•×‘×¢×™× ×©×¢×” ×•××§×•×?");
    wa.href = "https://wa.me/?text=" + text;

    yesBtn.disabled = true;
    noBtn.disabled = true;
    yesBtn.style.opacity = "0.75";
    noBtn.style.opacity = "0.55";
  });

  // hearts
  const card = document.getElementById("card");
  for(let i=0;i<10;i++){
    const h=document.createElement("div");
    h.className="heart";
    h.style.left = Math.random()*100 + "%";
    h.style.top  = Math.random()*100 + "%";
    h.style.transform = `rotate(45deg) scale(${0.8 + Math.random()*1.6})`;
    card.appendChild(h);
  }

  renderGate();
  moveNo();
</script>
</body>
</html>
